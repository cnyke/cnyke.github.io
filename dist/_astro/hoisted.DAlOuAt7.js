import"https://d3js.org/d3.v7.min.js";import"./hoisted.lCUHE6ev.js";async function I(){try{const t=[{imageUrl:"/images/mosquitoimages/Aedes (Stegomyia) UK Female 2022.jpeg",fileName:"Aedes (Stegomyia) UK Female 2022",scientificName:"Aedes (Stegomyia)",sex:"Female",year:"2022",country:"UK"},{imageUrl:"/images/mosquitoimages/Aedes (Stegomyia) UK Male 2016.jpeg",fileName:"Aedes (Stegomyia) UK Male 2016",scientificName:"Aedes (Stegomyia)",sex:"Male",year:"2016",country:"UK"},{imageUrl:"/images/mosquitoimages/Aedes (Ochlerotatus) UK Female 2022.jpeg",fileName:"Aedes (Ochlerotatus) UK Female 2022",scientificName:"Aedes (Ochlerotatus)",sex:"Female",year:"2022",country:"UK"},{imageUrl:"/images/mosquitoimages/Culex (Melanoconion) UK Female 2017.jpeg",fileName:"Culex (Melanoconion) UK Female 2017",scientificName:"Culex (Melanoconion)",sex:"Female",year:"2017",country:"UK"},{imageUrl:"/images/mosquitoimages/Anopheles (Cellia) UK Female 2022.jpeg",fileName:"Anopheles (Cellia) UK Female 2022",scientificName:"Anopheles (Cellia)",sex:"Female",year:"2022",country:"UK"}];console.log(`Loaded ${t.length} mosquito specimens from static files`),S(),U(t)}catch(t){console.error("Error loading mosquito gallery:",t),S(),L()}}function S(){const t=document.getElementById("gallery-loading"),e=document.getElementById("specimen-gallery");console.log("Hiding loading indicator...",{loading:!!t,gallery:!!e}),t&&(t.style.display="none",console.log("Loading indicator hidden")),e&&(e.classList.remove("hidden"),console.log("Gallery shown"))}function L(){const t=document.getElementById("gallery-loading");t&&(t.innerHTML=`
          <div class="text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
              <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <p class="text-red-600">Error loading specimen gallery</p>
          </div>
        `)}function U(t){const e=document.getElementById("gallery-grid");if(console.log("Displaying gallery...",{galleryGrid:!!e,specimens:t.length}),!e){console.log("ERROR: Gallery grid element not found!");return}const r=t.map(a=>`
          <div class="masonry-item bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 mb-6 block">
            <div class="relative">
              <img 
                src="${a.imageUrl}" 
                alt="${a.fileName||a.scientificName}"
                class="w-full h-auto object-contain"
                onload="console.log('Image loaded successfully:', this.src);"
                onerror="console.log('Image failed to load:', this.src); this.parentElement.parentElement.style.display='none';"
                loading="lazy"
              />
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                <h3 class="text-white font-semibold text-lg mb-1">${a.scientificName}</h3>
                <p class="text-white/90 text-sm">${a.sex} • ${a.year} • ${a.country}</p>
              </div>
            </div>
          </div>
        `).join("");console.log("Setting gallery HTML...",r.length,"characters"),e.innerHTML=r,console.log("Gallery HTML set successfully")}document.addEventListener("DOMContentLoaded",function(){I(),k()});let p=[],g=[],m=1;const w=20;async function k(){try{const r=(await(await fetch("/data/allnhmspecimensculicidae9.21.25/allnhmspecimensculicidae.csv")).text()).split(`
`),a=r[0].split(","),o={};a.forEach((l,s)=>{o[l.trim()]=s}),console.log("CSV headers loaded, total columns:",a.length);const n=[];for(let l=1;l<r.length;l++)if(r[l].trim())try{const s=M(r[l]);if(s.length>Math.max(...Object.values(o))){const d={genus:h(s[o.genus]),higherGeography:h(s[o.higherGeography]),lifeStage:h(s[o.lifeStage]),locality:h(s[o.locality]),preservative:h(s[o.preservative]),scientificName:h(s[o.scientificName]),sex:h(s[o.sex]),year:h(s[o.year])};d.scientificName&&d.scientificName!=="Unknown"&&n.push(d)}}catch(s){console.log(`Error parsing line ${l}:`,s);continue}console.log(`Loaded ${n.length} specimens for dashboard`),p=n,g=[...n],$(),E(),b(),F()}catch(t){console.error("Error loading dashboard data:",t),D()}}function M(t){const e=[];let r="",a=!1;for(let o=0;o<t.length;o++){const n=t[o];n==='"'?a=!a:n===","&&!a?(e.push(r),r=""):r+=n}return e.push(r),e}function h(t){if(!t)return"Unknown";let e=t.toString().replace(/^"|"$/g,"").trim()||"Unknown";return e.toLowerCase()==="adult"&&(e="Adult"),e.toLowerCase()==="male"&&(e="Male"),e.toLowerCase()==="female"&&(e="Female"),e}function $(){const t={"genus-filter":new Set,"geography-filter":new Set,"lifestage-filter":new Set,"locality-filter":new Set,"preservative-filter":new Set,"sex-filter":new Set,"year-filter":new Set};p.forEach(e=>{e.genus&&e.genus!=="Unknown"&&t["genus-filter"].add(e.genus),e.higherGeography&&e.higherGeography!=="Unknown"&&t["geography-filter"].add(e.higherGeography),e.lifeStage&&e.lifeStage!=="Unknown"&&t["lifestage-filter"].add(e.lifeStage),e.locality&&e.locality!=="Unknown"&&t["locality-filter"].add(e.locality),e.preservative&&e.preservative!=="Unknown"&&t["preservative-filter"].add(e.preservative),e.sex&&e.sex!=="Unknown"&&t["sex-filter"].add(e.sex),e.year&&e.year!=="Unknown"&&t["year-filter"].add(e.year)}),Object.keys(t).forEach(e=>{const r=document.getElementById(e);if(!r)return;const a=Array.from(t[e]).sort();for(;r.children.length>1;){const o=r.lastChild;o&&r.removeChild(o)}a.forEach(o=>{const n=document.createElement("option");n.value=o,n.textContent=o,r.appendChild(n)})}),console.log("Filter options populated")}function C(){const t=document.getElementById("genus-filter")?.value||"",e=document.getElementById("geography-filter")?.value||"",r=document.getElementById("lifestage-filter")?.value||"",a=document.getElementById("locality-filter")?.value||"",o=document.getElementById("preservative-filter")?.value||"",n=document.getElementById("sex-filter")?.value||"",l=document.getElementById("year-filter")?.value||"";g=p.filter(s=>(!t||s.genus===t)&&(!e||s.higherGeography===e)&&(!r||s.lifeStage===r)&&(!a||s.locality===a)&&(!o||s.preservative===o)&&(!n||s.sex===n)&&(!l||s.year===l)),m=1,E(),b()}function E(){const t=document.getElementById("data-table-body"),e=document.getElementById("result-count"),r=document.getElementById("showing-from"),a=document.getElementById("showing-to"),o=document.getElementById("total-results"),n=document.getElementById("page-info");e&&(e.textContent=`Showing ${g.length} of ${p.length} specimens`),o&&(o.textContent=g.length.toString());const l=Math.ceil(g.length/w),s=(m-1)*w,d=Math.min(s+w,g.length),x=g.slice(s,d);r&&(r.textContent=(g.length>0?s+1:0).toString()),a&&(a.textContent=d.toString()),n&&(n.textContent=`Page ${m} of ${l}`);const f=document.querySelectorAll("#prev-page, #prev-page-mobile"),B=document.querySelectorAll("#next-page, #next-page-mobile");f.forEach(c=>c.disabled=m<=1),B.forEach(c=>c.disabled=m>=l),t&&(t.innerHTML="",x.forEach(c=>{const u=document.createElement("tr");u.className="hover:bg-gray-50",u.innerHTML=`
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${c.genus}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.sex}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.lifeStage}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate" title="${c.locality}">${c.locality}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate" title="${c.higherGeography}">${c.higherGeography}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.preservative}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.year}</td>
          `,t.appendChild(u)}))}function F(){const t=document.getElementById("dashboard-loading"),e=document.getElementById("dashboard-content");t&&(t.style.display="none"),e&&e.classList.remove("hidden")}function D(){const t=document.getElementById("dashboard-loading");t&&(t.innerHTML=`
          <div class="text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
              <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <p class="text-red-600">Error loading dashboard data</p>
          </div>
        `)}function b(){const t=document.getElementById("histogram-chart"),e=document.getElementById("histogram-loading");if(!t)return;const r={};g.forEach(n=>{const l=n.genus||"Unknown";r[l]=(r[l]||0)+1});const a=g.length===p.length;let o;if(a){const n=[];let l=0;Object.entries(r).forEach(([s,d])=>{d>=50?n.push({genus:s,count:d}):l+=d}),n.sort((s,d)=>d.count-s.count),o=[...n],l>0&&o.push({genus:"Other",count:l})}else o=Object.entries(r).map(([n,l])=>({genus:n,count:l})).sort((n,l)=>l.count-n.count);e&&e.classList.add("hidden"),t.classList.remove("hidden"),N(t,o)}function N(t,e){if(d3.select(t).selectAll("*").remove(),e.length===0){d3.select(t).append("div").style("text-align","center").style("padding","2rem").style("color","#6B7280").text("No data to display. Please try different filters.");return}const r=t.clientWidth,a=r<640,o={top:20,right:20,bottom:a?80:60,left:a?50:60},n=a?8:12,l=a?2:3,s=e.length*(n+l),d=Math.max(r-o.left-o.right,s),x=d+o.left+o.right,f=a?250:300,c=d3.select(t).append("svg").attr("width",x).attr("height",f).style("min-width",`${x}px`).append("g").attr("transform",`translate(${o.left},${o.top})`),u=d3.scaleBand().domain(e.map(i=>i.genus)).range([0,d]).paddingInner(l/(n+l)).paddingOuter(.1),y=d3.scaleLinear().domain([0,d3.max(e,i=>i.count)||0]).range([f-o.top-o.bottom,0]),A=d3.scaleOrdinal().domain(e.map(i=>i.genus)).range(["#DC2626","#EA580C","#D97706","#CA8A04","#65A30D","#16A34A","#059669","#0891B2","#0284C7","#2563EB","#7C3AED","#C026D3","#DB2777","#E11D48","#F59E0B"]);c.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",i=>u(i.genus)||0).attr("width",Math.min(n,u.bandwidth())).attr("y",i=>y(i.count)).attr("height",i=>f-o.top-o.bottom-y(i.count)).attr("fill",i=>A(i.genus)).style("opacity",.8).on("mouseover",function(i,v){d3.select(this).style("opacity",1),d3.select("body").append("div").attr("class","histogram-tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000").html(`<strong>${v.genus}</strong><br/>${v.count} specimens`).style("left",i.pageX+10+"px").style("top",i.pageY-10+"px")}).on("mouseout",function(){d3.select(this).style("opacity",.8),d3.selectAll(".histogram-tooltip").remove()}),c.selectAll(".bar-label").data(e.filter(i=>i.count>(d3.max(e,v=>v.count)||0)*.05)).enter().append("text").attr("class","bar-label").attr("x",i=>(u(i.genus)||0)+Math.min(n,u.bandwidth())/2).attr("y",i=>y(i.count)-5).attr("text-anchor","middle").style("font-size",a?"10px":"11px").style("fill","#374151").text(i=>i.count),c.append("g").attr("transform",`translate(0,${f-o.top-o.bottom})`).call(d3.axisBottom(u).tickSize(0)).style("font-size",a?"8px":"10px").selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",`rotate(-${a?45:35})`),c.append("g").call(d3.axisLeft(y).ticks(a?4:6)).style("font-size",a?"8px":"10px"),c.selectAll(".grid-line").data(y.ticks(a?4:6)).enter().append("line").attr("class","grid-line").attr("x1",0).attr("x2",d).attr("y1",i=>y(i)).attr("y2",i=>y(i)).style("stroke","#F3F4F6").style("stroke-width",.5).style("opacity",.7),c.append("text").attr("transform","rotate(-90)").attr("y",0-o.left).attr("x",0-(f-o.top-o.bottom)/2).attr("dy","1em").style("text-anchor","middle").style("font-size",a?"10px":"12px").style("fill","#6B7280").text("Number of Specimens")}document.addEventListener("DOMContentLoaded",function(){const t=["genus-filter","geography-filter","lifestage-filter","locality-filter","preservative-filter","sex-filter","year-filter"];t.forEach(n=>{const l=document.getElementById(n);l&&l.addEventListener("change",C)});const e=document.getElementById("clear-filters");e&&e.addEventListener("click",function(){t.forEach(n=>{const l=document.getElementById(n);l&&(l.value="")}),C()});const r=document.querySelectorAll("#prev-page, #prev-page-mobile"),a=document.querySelectorAll("#next-page, #next-page-mobile");r.forEach(n=>{n.addEventListener("click",function(){m>1&&(m--,E())})}),a.forEach(n=>{n.addEventListener("click",function(){const l=Math.ceil(g.length/w);m<l&&(m++,E())})});let o;window.addEventListener("resize",function(){clearTimeout(o),o=setTimeout(()=>{g.length>0&&b()},250)})});
