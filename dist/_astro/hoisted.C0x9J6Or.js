import"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js";import"./hoisted.t_BYlHZp.js";let y,r=[],x=[],a=2014,B=!1,C;const p=window.L,E={"Octopus vulgaris Cuvier, 1797":"#FF6B6B","Octopus tetricus Gould, 1852":"#4ECDC4","Octopus cyanea Gray, 1849":"#45B7D1","Octopus bimaculoides Pickford & McConnaughey, 1949":"#F7DC6F","Octopus rubescens S.S.Berry, 1953":"#BB8FCE","Octopus insularis Leite & Haimovici, 2008":"#52C4B0","Octopus briareus G.C.Robson, 1929":"#FF8A65","Octopus djinda Amor, 2021":"#5D6D7E","Octopus americanus Froriep, 1806":"#EC7063","Octopus berrima Stranks & Norman, 1992":"#58D68D","Octopus pallidus Hoyle, 1885":"#F8C471","Octopus kaurna Stranks, 1990":"#85929E","Octopus hubbsorum S.S.Berry, 1953":"#A569BD","Octopus sinensis d'Orbigny, 1834":"#FF7043","Octopus oculifer (Hoyle, 1904)":"#26A69A","Octopus tehuelchus d'Orbigny":"#7986CB","Octopus joubini G.C.Robson, 1929":"#FFB74D","Octopus mimus Gould, 1852":"#66BB6A","Octopus micropyrsus S.S.Berry, 1953":"#42A5F5","Octopus hummelincki Adam, 1936":"#FFCA28","Octopus australis Hoyle, 1885":"#AB47BC","Octopus bimaculatus A.E.Verrill, 1883":"#26C6DA","Octopus maya G.L.Voss & Solís, 1966":"#9CCC65","Octopus wolfi (Wülker, 1913)":"#FFA726","Octopus fitchi S.S.Berry, 1953":"#8D6E63","Octopus veligero S.S.Berry, 1953":"#78909C","Octopus salutii Vérany, 1839":"#F06292","Octopus minor (Sasaki, 1920)":"#5C6BC0","Octopus laqueus Kaneko & Kubodera, 2005":"#4DB6AC","Octopus bocki Adam, 1941":"#FF7043","Octopus californicus (S.S.Berry, 1911)":"#D4E157","Octopus Cuvier, 1798":"#90A4AE"};async function D(){try{const e=(await(await fetch("/data/OctopusGBIF.csv")).text()).split(`
`),o=e[0].split("	"),s=o.indexOf("decimalLatitude"),i=o.indexOf("decimalLongitude"),m=o.indexOf("scientificName"),f=o.indexOf("year"),g=o.indexOf("locality"),L=o.indexOf("countryCode"),S=o.indexOf("recordedBy"),A=o.indexOf("eventDate");r=[];for(let O=1;O<e.length;O++){const c=e[O].split("	");if(c.length<o.length)continue;const l=parseFloat(c[s]),d=parseFloat(c[i]),u=parseInt(c[f]),h=c[m];!isNaN(l)&&!isNaN(d)&&!isNaN(u)&&l>=-90&&l<=90&&d>=-180&&d<=180&&u>=2e3&&u<=2024&&h&&r.push({lat:l,lng:d,species:h,year:u,locality:c[g]||"Unknown",country:c[L]||"Unknown",observer:c[S]||"Unknown",date:c[A]||"Unknown"})}console.log(`Loaded ${r.length} octopus observations`),I(),v(),F()}catch(t){console.error("Error loading octopus data:",t),I();const n=document.getElementById("legend-content");n&&(n.innerHTML='<p class="text-red-500">Error loading data</p>')}}function I(){const t=document.getElementById("loading-indicator");t&&(t.style.display="none")}function v(){x.forEach(e=>y.removeLayer(e)),x=[];const t=r.filter(e=>e.year===a);t.forEach(e=>{const o=E[e.species]||"#999999",s=p.circleMarker([e.lat,e.lng],{radius:6,fillColor:o,color:"transparent",weight:0,opacity:0,fillOpacity:.8}),i=`
          <div class="p-2">
            <h4 class="font-semibold text-sm mb-2" style="color: ${o};">${e.species}</h4>
            <div class="text-xs space-y-1">
              <p><strong>Date:</strong> ${e.date}</p>
              <p><strong>Coordinates:</strong> ${e.lat.toFixed(4)}, ${e.lng.toFixed(4)}</p>
            </div>
          </div>
        `;s.bindPopup(i),s.addTo(y),x.push(s)});const n=document.getElementById("data-count");n&&(n.textContent=`${t.length} observations in ${a}`)}function F(){const t=r.filter(s=>s.year===a),n=[...new Set(t.map(s=>s.species))].sort(),e=document.getElementById("legend-content");if(!e)return;if(n.length===0){e.innerHTML='<p class="text-gray-500">No data for this year</p>';return}const o=n.map(s=>{const i=E[s]||"#999999",m=t.filter(g=>g.species===s).length,f=s.split(" ").slice(0,2).join(" ");return`
          <div class="flex items-center space-x-2">
            <div class="w-3 h-3 rounded-full border border-white" style="background-color: ${i};"></div>
            <span class="text-gray-700 flex-1">${f}</span>
            <span class="text-gray-500">${m}</span>
          </div>
        `}).join("");e.innerHTML=o}function b(t){a=parseInt(t);const n=document.getElementById("current-year"),e=document.getElementById("year-slider");n&&(n.textContent=a.toString()),e&&(e.value=a.toString()),v(),F()}function k(){B?T():w()}function w(){B=!0;const t=document.getElementById("play-icon"),n=document.getElementById("pause-icon"),e=document.getElementById("play-text");t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),e&&(e.textContent="Pause"),C=setInterval(()=>{a>=2024?a=2e3:a++,b(a)},600)}function T(){B=!1;const t=document.getElementById("play-icon"),n=document.getElementById("pause-icon"),e=document.getElementById("play-text");t&&t.classList.remove("hidden"),n&&n.classList.add("hidden"),e&&(e.textContent="Play"),C&&clearInterval(C)}document.addEventListener("DOMContentLoaded",function(){if(typeof window<"u"&&p){y=p.map("octopus-map",{zoomControl:!1,scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1,boxZoom:!1}).setView([15,-85],3),p.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"© OpenStreetMap contributors © CARTO"}).addTo(y);const t=document.getElementById("year-slider"),n=document.getElementById("play-pause-btn");t&&t.addEventListener("input",e=>{const o=e.target;o&&b(o.value)}),n&&n.addEventListener("click",k),D()}});
